<div class="bg-white rounded-2xl border border-gray-200 shadow-sm p-6">
  <div class="flex items-start justify-between gap-4">
    <div>
      <h2 class="text-xl font-bold text-gray-900">Feedbacks</h2>
      <p class="mt-1 text-sm text-gray-500">See what enrolled students think about this course.</p>
    </div>

    <!-- Stats -->
    <div class="shrink-0 flex items-center gap-3">
      <div class="rounded-2xl border border-gray-200 bg-gray-50 px-4 py-2">
        <div class="text-xs text-gray-500">Total</div>
        <div class="text-lg font-bold text-gray-900">{{ total_feedbacks|default:0 }}</div>
      </div>

      <div class="rounded-2xl border border-gray-200 bg-gray-50 px-4 py-2">
        <div class="text-xs text-gray-500">Average</div>
        <div class="text-lg font-bold text-gray-900">
          {{ avg_rating|default:"—" }}
          <span class="text-sm font-semibold text-gray-500">/ 5</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters (GET) -->
  <form method="get"
        action="{% url 'courses:course_detail' course.id %}"
        class="mt-5 flex flex-col md:flex-row md:items-center gap-3">

    <div class="flex gap-3">
      <div>
        <label class="sr-only" for="fb_min_rating">Min rating</label>
        <select id="fb_min_rating"
                name="min_rating"
                class="rounded-2xl border border-gray-200 px-4 py-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-200">
          <option value="" {% if not request.GET.min_rating %}selected{% endif %}>All ratings</option>
          <option value="5" {% if request.GET.min_rating == "5" %}selected{% endif %}>5★ only</option>
          <option value="4" {% if request.GET.min_rating == "4" %}selected{% endif %}>4★ and up</option>
          <option value="3" {% if request.GET.min_rating == "3" %}selected{% endif %}>3★ and up</option>
          <option value="2" {% if request.GET.min_rating == "2" %}selected{% endif %}>2★ and up</option>
          <option value="1" {% if request.GET.min_rating == "1" %}selected{% endif %}>1★ and up</option>
        </select>
      </div>

      <div>
        <label class="sr-only" for="fb_sort">Sort</label>
        <select id="fb_sort"
                name="sort"
                class="rounded-2xl border border-gray-200 px-4 py-3 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-200">
          <option value="newest" {% if request.GET.sort|default:"newest" == "newest" %}selected{% endif %}>Newest</option>
          <option value="top" {% if request.GET.sort == "top" %}selected{% endif %}>Rating: high → low</option>
          <option value="low" {% if request.GET.sort == "low" %}selected{% endif %}>Rating: low → high</option>
        </select>
      </div>

      <button type="submit"
              class="px-5 py-3 rounded-2xl bg-blue-600 text-white font-semibold hover:bg-blue-700 transition">
        Apply
      </button>
    </div>
  </form>

  <!-- Feedback list -->
  <div class="mt-6 space-y-4">
    {% for fb in feedbacks %}
      <div class="rounded-2xl border border-gray-200 bg-white p-5">
        <div class="flex items-start justify-between gap-4">
          <div class="min-w-0">
            <div class="font-semibold text-gray-900 truncate">
              {{ fb.student.full_name|default:fb.student.username }}
            </div>
            <div class="mt-1 text-sm text-gray-500">
              {{ fb.created_at|date:"M j, Y" }}
              {% if fb.updated_at and fb.updated_at != fb.created_at %}
                <span class="text-gray-400">• Edited {{ fb.updated_at|date:"M j, Y" }}</span>
              {% endif %}
            </div>
          </div>

          <div class="shrink-0 inline-flex items-center gap-2">
            <span class="inline-flex items-center px-3 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-100 text-sm font-semibold">
              {{ fb.rating }}★
            </span>
          </div>
        </div>

        {% if fb.comment %}
          <p class="mt-3 text-sm text-gray-700 leading-relaxed">
            {{ fb.comment }}
          </p>
        {% else %}
          <p class="mt-3 text-sm text-gray-500 italic">
            No written comment.
          </p>
        {% endif %}
      </div>
    {% empty %}
      <div class="rounded-2xl border border-gray-200 bg-gray-50 p-6 text-sm text-gray-500">
        No feedback yet.
      </div>
    {% endfor %}
  </div>

  {# Optional: pagination UI if you paginate feedbacks #}
  {% if is_paginated %}
    <div class="mt-6 flex items-center justify-between text-sm">
      <div class="text-gray-500">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
      </div>
      <div class="flex gap-2">
        {% if page_obj.has_previous %}
          <a class="px-3 py-2 rounded-xl border border-gray-200 hover:bg-gray-50"
             href="?tab=feedback&q={{ request.GET.q|urlencode }}&min_rating={{ request.GET.min_rating }}&sort={{ request.GET.sort|default:'newest' }}&page={{ page_obj.previous_page_number }}">Prev</a>
        {% endif %}
        {% if page_obj.has_next %}
          <a class="px-3 py-2 rounded-xl border border-gray-200 hover:bg-gray-50"
             href="?tab=feedback&q={{ request.GET.q|urlencode }}&min_rating={{ request.GET.min_rating }}&sort={{ request.GET.sort|default:'newest' }}&page={{ page_obj.next_page_number }}">Next</a>
        {% endif %}
      </div>
    </div>
  {% endif %}
</div>