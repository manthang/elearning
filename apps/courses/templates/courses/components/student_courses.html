<div>
  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
    <div>
      <p class="text-sm text-gray-500 mt-1">
        {% if is_own_profile %}
          Stay on track with your enrolled courses.
        {% else %}
          Courses {{ profile_user.full_name|default:profile_user.username }} is currently taking.
        {% endif %}
      </p>
    </div>

    <div class="relative w-full sm:w-72 group">
      <input type="text"
             id="localCourseSearch"
             placeholder="Search courses..."
             class="w-full pl-10 pr-4 py-2.5 rounded-xl border border-gray-200
                    bg-white shadow-sm transition-all text-sm text-gray-700
                    focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent" />
      <svg xmlns="http://www.w3.org/2000/svg"
           class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400 group-focus-within:text-blue-600 transition-colors"
           viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
      </svg>
    </div>
  </div>

  <div class="mt-6 space-y-4" id="myCoursesList">
    {% for c in enrolled_courses %}
      {% with pct=c.progress|default:0 %}
      <div class="course-card group relative overflow-hidden bg-white rounded-2xl border border-gray-200 shadow-sm hover:shadow-md hover:border-gray-300 transition"
           data-course-title="{{ c.title|lower }}"
           data-course-display-title="{{ c.title|escapejs }}"
           data-course-id="{{ c.id }}"
           data-detail-url="{% url 'courses:course_detail' c.id %}"
           data-feedback-rating="{{ c.feedback_rating|default:0 }}"
           data-feedback-comment="{{ c.feedback_comment|default:''|escapejs }}">

        <a href="{% url 'courses:course_detail' c.id %}" class="absolute inset-0 z-10" aria-label="Open course"></a>

        <div class="relative flex items-stretch flex-col sm:flex-row">
          
          <div class="relative w-full sm:w-56 h-40 sm:h-auto shrink-0 bg-gray-100 border-r border-gray-100">
            {% if c.thumbnail %}
              <img src="{{ c.thumbnail.url }}" alt="{{ c.title }}" class="h-full w-full object-cover"/>
            {% else %}
              <div class="h-full w-full bg-gradient-to-br from-slate-100 to-slate-200"></div>
            {% endif %}

            {% if is_own_profile %}
              <div class="absolute inset-0 flex items-center justify-center z-20 pointer-events-none bg-black/5 opacity-0 group-hover:opacity-100 transition-opacity">
                <span class="scale-95 group-hover:scale-100 transition-transform inline-flex items-center justify-center h-14 w-14 rounded-full shadow-lg text-white ring-4 ring-white/60 {% if pct|default:0 > 0 %}bg-blue-600{% else %}bg-emerald-600{% endif %}">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 ml-1" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8 5v14l11-7z"/>
                  </svg>
                </span>
              </div>
            {% endif %}
          </div>

          <div class="flex-1 min-w-0 px-6 py-5 flex flex-col justify-center">
            <h4 class="text-xl font-semibold text-gray-900 leading-snug line-clamp-2">
              {{ c.title }}
            </h4>

            <div class="mt-2 text-sm text-gray-600 truncate">
              {% for teaching in c.teachings.all %}
                {{ teaching.teacher.full_name|default:teaching.teacher.username }}{% if not forloop.last %}, {% endif %}
              {% empty %}
                <span class="text-gray-400">Instructor TBA</span>
              {% endfor %}
            </div>

            <div class="mt-3 flex items-center gap-4 text-sm text-gray-500">
              <span>{{ c.duration|default:"-" }} weeks</span>
              <span class="text-gray-300">•</span>
              <span>{{ c.enrollment_count|default:0 }} students</span>
            </div>

            {% if is_own_profile %}
              <div class="mt-6">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-sm text-gray-700">
                    <span class="font-bold">{{ pct }}%</span> <span class="text-gray-500 font-medium">complete</span>
                  </div>
                </div>

                <div class="h-1.5 w-full rounded-full bg-gray-100 overflow-hidden">
                  <div class="h-full rounded-full bg-blue-600 transition-all duration-500" style="width: {{ pct }}%;"></div>
                </div>

                <div class="mt-4 flex items-center justify-end relative z-20">
                  <button type="button"
                          class="rating-chip inline-flex items-center gap-2 text-sm text-gray-700 hover:text-gray-900"
                          data-open-feedback="1"
                          onclick="event.stopPropagation();">
                    <span class="inline-flex items-center gap-0.5" data-rating-stars>
                      {% for i in "12345" %}
                        <svg xmlns="http://www.w3.org/2000/svg"
                             class="h-4 w-4 {% if c.feedback_rating|default:0 >= forloop.counter %}text-amber-500{% else %}text-gray-300{% endif %}"
                             viewBox="0 0 24 24" fill="currentColor">
                          <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                        </svg>
                      {% endfor %}
                    </span>

                    {% if c.feedback_rating|default:0 > 0 %}
                      <span class="rating-default text-gray-600" data-rating-label>Your rating</span>
                      <span class="rating-hover hidden text-gray-900 font-medium">Edit rating</span>
                    {% else %}
                      <span class="rating-default text-gray-600" data-rating-label>Leave a rating</span>
                      <span class="rating-hover hidden text-gray-900 font-medium">Leave a rating</span>
                    {% endif %}
                  </button>
                </div>
              </div>
            {% endif %}

          </div>
        </div>
      </div>
      {% endwith %}
    {% empty %}
      <div class="rounded-2xl border-2 border-dashed border-gray-200 bg-gray-50 p-10 text-center flex flex-col items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-300 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
        </svg>
        <div class="text-sm font-medium text-gray-500">
          {% if is_own_profile %}
            You haven’t enrolled in any courses yet.
          {% else %}
            {{ profile_user.full_name|default:profile_user.username }} hasn't enrolled in any courses yet.
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
</div>

{% if is_own_profile %}
  {% include "courses/shared/feedback_modal.html" %}
{% endif %}

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const searchInput = document.getElementById("localCourseSearch");
    const courseCards = document.querySelectorAll(".course-card");

    if (searchInput) {
      searchInput.addEventListener("input", function(e) {
        const query = e.target.value.toLowerCase();
        
        courseCards.forEach(card => {
          const title = card.getAttribute("data-course-title") || "";
          if (title.includes(query)) {
            card.style.display = "";
          } else {
            card.style.display = "none";
          }
        });
      });
    }
  });
</script>