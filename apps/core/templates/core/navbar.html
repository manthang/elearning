<nav class="bg-white border-b border-gray-100">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
    <!-- Brand / Home -->
    <a href="{% url 'core:home' %}"
        class="inline-flex items-center gap-2 font-semibold text-gray-900">
      <span class="inline-flex items-center justify-center w-10 h-10 rounded-xl bg-blue-50 text-blue-600 border border-blue-100">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m22 10-10-5L2 10l10 5 10-5Z"/>
          <path d="M6 12v5c0 1 3 3 6 3s6-2 6-3v-5"/>
        </svg>
      </span>
      <span class="text-lg">eLearning</span>
    </a>

    <!-- Right -->
    <div class="flex items-center gap-3">
      {% if user.is_authenticated %}

        <!-- User menu -->
        <div class="relative">
          <button type="button"
                  id="userMenuBtn"
                  onclick="toggleUserMenu()"
                  class="inline-flex items-center gap-2 rounded-xl px-2 py-1.5 hover:bg-gray-50 transition"
                  aria-haspopup="menu"
                  aria-expanded="false">
            <div class="w-9 h-9 rounded-xl overflow-hidden bg-gray-100">
              <img src="{{ user.avatar_url }}" class="w-full h-full object-cover" alt="Avatar">
            </div>
            <svg xmlns="http://www.w3.org/2000/svg"
                 class="h-4 w-4 text-gray-400"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round">
              <path d="m6 9 6 6 6-6"/>
            </svg>
          </button>

          <div id="userMenu"
               class="hidden absolute right-0 mt-2 w-52 bg-white border border-gray-200 rounded-2xl shadow-lg py-2 z-50"
               role="menu"
               aria-labelledby="userMenuBtn">
            <button type="button"
                    onclick="openProfileModal(); closeUserMenu();"
                    class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
                    role="menuitem">
              Edit profile
            </button>

            <div class="border-t border-gray-100 my-1"></div>

            <a href="{% url 'accounts:logout' %}"
               class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50"
               role="menuitem">
              Logout
            </a>
          </div>
        </div>

      {% else %}

        <a href="{% url 'accounts:login' %}"
           class="inline-flex items-center px-4 py-2 rounded-xl border border-gray-200 bg-white
                  text-sm font-semibold text-gray-700 hover:bg-gray-50 hover:border-gray-300 transition">
          Login
        </a>

        <a href="/signup/"
           class="inline-flex items-center px-4 py-2 rounded-xl bg-blue-600
                  text-sm font-semibold text-white hover:bg-blue-700
                  shadow-[0_12px_30px_rgba(37,99,235,0.20)] transition">
          Sign Up
        </a>

      {% endif %}
    </div>
  </div>
</nav>

<script>
  function closeUserMenu() {
    const menu = document.getElementById("userMenu");
    const btn = document.getElementById("userMenuBtn");
    if (!menu || !btn) return;
    menu.classList.add("hidden");
    btn.setAttribute("aria-expanded", "false");
  }

  function openUserMenu() {
    const menu = document.getElementById("userMenu");
    const btn = document.getElementById("userMenuBtn");
    if (!menu || !btn) return;
    menu.classList.remove("hidden");
    btn.setAttribute("aria-expanded", "true");
  }

  function toggleUserMenu() {
    const menu = document.getElementById("userMenu");
    if (!menu) return;
    if (menu.classList.contains("hidden")) {
      openUserMenu();
    } else {
      closeUserMenu();
    }
  }

  // Close on click outside + Esc
  document.addEventListener("click", function (e) {
    const menu = document.getElementById("userMenu");
    const btn = document.getElementById("userMenuBtn");
    if (!menu || !btn) return;
    if (menu.classList.contains("hidden")) return;

    const clickedInside = menu.contains(e.target) || btn.contains(e.target);
    if (!clickedInside) closeUserMenu();
  });

  document.addEventListener("keydown", function (e) {
    if (e.key === "Escape") closeUserMenu();
  });
</script>
