<div id="chatModal"
     class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/40"
     onclick="closeChatModal()">

  <!-- Modal card -->
  <div class="bg-white rounded-xl shadow-xl w-full max-w-3xl h-[80vh] flex flex-col"
       onclick="event.stopPropagation()">

    <!-- Header -->
    <div class="flex items-center justify-between px-6 py-4 border-b">
      <div class="flex items-center gap-3">
        <img id="chatAvatar"
             class="w-10 h-10 rounded-full object-cover"
             src=""
             alt="User avatar" />

        <div>
          <p id="chatName" class="font-semibold text-sm"></p>
          <p id="chatRole" class="text-xs text-gray-500"></p>
        </div>
      </div>

      <button type="button"
              onclick="closeChatModal()"
              class="text-gray-400 hover:text-gray-600">
        ✕
      </button>
    </div>

    <!-- Messages -->
    <div id="chatMessages"
         class="flex-1 overflow-y-auto px-6 py-4 space-y-4 bg-gray-50">
    </div>

    <!-- Message Templates -->
    <template id="messageTemplateMine">
      <div class="flex justify-end">
        <div class="bg-blue-600 text-white px-4 py-2 rounded-2xl rounded-br-sm max-w-[70%] shadow">
          <p class="message-text text-sm"></p>
          <p class="message-time text-xs mt-1 text-blue-100 text-right"></p>
        </div>
      </div>
    </template>

    <template id="messageTemplateOther">
      <div class="flex justify-start">
        <div class="bg-white border px-4 py-2 rounded-2xl rounded-bl-sm max-w-[70%] shadow">
          <p class="message-text text-sm"></p>
          <p class="message-time text-xs mt-1 text-gray-400 text-right"></p>
        </div>
      </div>
    </template>

    <!-- Composer -->
    <form id="chatForm"
          onsubmit="sendMessage(event)"
          class="border-t px-4 py-3 flex items-center gap-3">

      <input id="chatInput"
             type="text"
             placeholder="Type your message..."
             autocomplete="off"
             class="flex-1 border rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring"
             required />

      <button type="button"
              onclick="sendMessage()"
              class="bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-4 py-2">
        ➤
      </button>
    </form>

  </div>
</div>
